{"ast":null,"code":"import _slicedToArray from\"/Users/iashir/Desktop/WorkProjects/Recipe/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import SingleComment from\"./singleComment\";import CommentInput from\"./commentInput\";import{toast}from\"react-toastify\";import{isAuthenticated}from\"../../helper/auth\";import axios from\"axios\";import{useParams}from\"react-router-dom\";import{showLoading}from\"../../helper/loading\";var imageProf=require(\"../../../public/uploads/chef2.jpg\");var Comments=function Comments(){var recipe=useParams();var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),newComment=_useState2[0],setnewComment=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),newReplyComment=_useState4[0],setnewReplyComment=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),comments=_useState6[0],setComments=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),repliedComments=_useState8[0],setRepliedComments=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),openReply=_useState10[0],setOpenReply=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),loading=_useState12[0],setLoading=_useState12[1];var _useState13=useState(\"\"),_useState14=_slicedToArray(_useState13,2),replyId=_useState14[0],setReplyId=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),parentCommentId=_useState16[0],setParentCommentId=_useState16[1];var _useState17=useState(\"\"),_useState18=_slicedToArray(_useState17,2),responseTo=_useState18[0],setResponseTo=_useState18[1];var _useState19=useState(0),_useState20=_slicedToArray(_useState19,2),commentsAdded=_useState20[0],setCommentsAdded=_useState20[1];///////////////////////////////////////////\nuseEffect(function(){setLoading(true);axios.get(\"/api/comment/\"+recipe.id).then(function(_ref){var data=_ref.data;setComments(data.comments.reverse());setRepliedComments(data.repliedComments);setLoading(false);}).catch(function(err){toast.error(\"Unable to load comments\");});},[commentsAdded,recipe.id]);/////////////////////////////////////////\nvar handleComment=function handleComment(e){e.preventDefault();if(!isAuthenticated()){return toast.error(\"Please login\",{position:\"bottom-center\",autoClose:5000,hideProgressBar:false,closeOnClick:true,pauseOnHover:true,draggable:true,progress:undefined});}var _JSON$parse=JSON.parse(localStorage.user),_id=_JSON$parse._id;var comment=e.target.name===\"newReplyComment\"||replyId===e.target.id?newReplyComment:newComment;var obj={};if(e.target.name===\"newReplyComment\"&&parentCommentId!==\"\"){obj={user:_id,content:comment,recipe:recipe.id,responseTo:responseTo,parentComment:parentCommentId};}else{obj={user:_id,content:comment,recipe:recipe.id};}var name=e.target.name;if(comment===\"\"){return toast.error(\"empty comment\");}setLoading(true);// this.setState({ loading: true });\naxios.post(\"/api/comment/\"+recipe.id,obj).then(function(res){if(res.data.success){console.log(res.data);setOpenReply(false);setLoading(false);if(name===\"newComment\"){setnewComment(\"\");}else{setnewReplyComment(\"\");}setCommentsAdded(commentsAdded+1);}}).catch(function(error){toast.error(\"Error occured while posting comment\");});};///////////////////////////////////////////\nvar handleChange=function handleChange(e){if(e.target.name===\"newComment\"){setnewComment(e.target.value);}else{setnewReplyComment(e.target.value);}// this.setState({ [e.target.name]: e.target.value });\n};///////////////////////////////////////////\nvar showReplyInput=function showReplyInput(replyId,parentCommentId,responseTo){setOpenReply(!openReply);setReplyId(replyId);setParentCommentId(parentCommentId);setResponseTo(responseTo);};return/*#__PURE__*/React.createElement(React.Fragment,null,loading?showLoading():null,/*#__PURE__*/React.createElement(CommentInput,{onSubmit:handleComment,onChange:handleChange,value:newComment,name:\"newComment\"}),/*#__PURE__*/React.createElement(SingleComment,{comments:comments,imageProf:imageProf,showReplyInput:showReplyInput,openReply:openReply,onSubmit:handleComment,onChange:handleChange,replyId:replyId,newReplyComment:newReplyComment,repliedComments:repliedComments}));};export default Comments;","map":{"version":3,"sources":["/Users/iashir/Desktop/WorkProjects/Recipe/client/src/components/recipePage/sections/comment.jsx"],"names":["React","useState","useEffect","SingleComment","CommentInput","toast","isAuthenticated","axios","useParams","showLoading","imageProf","require","Comments","recipe","newComment","setnewComment","newReplyComment","setnewReplyComment","comments","setComments","repliedComments","setRepliedComments","openReply","setOpenReply","loading","setLoading","replyId","setReplyId","parentCommentId","setParentCommentId","responseTo","setResponseTo","commentsAdded","setCommentsAdded","get","id","then","data","reverse","catch","err","error","handleComment","e","preventDefault","position","autoClose","hideProgressBar","closeOnClick","pauseOnHover","draggable","progress","undefined","JSON","parse","localStorage","user","_id","comment","target","name","obj","content","parentComment","post","res","success","console","log","handleChange","value","showReplyInput"],"mappings":"uKAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CACA,MAAOC,CAAAA,aAAP,KAA0B,iBAA1B,CACA,MAAOC,CAAAA,YAAP,KAAyB,gBAAzB,CACA,OAASC,KAAT,KAAsB,gBAAtB,CACA,OAASC,eAAT,KAAgC,mBAAhC,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAASC,SAAT,KAA0B,kBAA1B,CACA,OAASC,WAAT,KAA4B,sBAA5B,CACA,GAAMC,CAAAA,SAAS,CAAGC,OAAO,CAAC,mCAAD,CAAzB,CACA,GAAMC,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,EAAM,CACrB,GAAMC,CAAAA,MAAM,CAAGL,SAAS,EAAxB,CADqB,cAEeP,QAAQ,CAAC,EAAD,CAFvB,wCAEda,UAFc,eAEFC,aAFE,8BAGyBd,QAAQ,CAAC,EAAD,CAHjC,yCAGde,eAHc,eAGGC,kBAHH,8BAIWhB,QAAQ,CAAC,EAAD,CAJnB,yCAIdiB,QAJc,eAIJC,WAJI,8BAKyBlB,QAAQ,CAAC,EAAD,CALjC,yCAKdmB,eALc,eAKGC,kBALH,8BAMapB,QAAQ,CAAC,KAAD,CANrB,0CAMdqB,SANc,gBAMHC,YANG,gCAOStB,QAAQ,CAAC,KAAD,CAPjB,2CAOduB,OAPc,gBAOLC,UAPK,gCAQSxB,QAAQ,CAAC,EAAD,CARjB,2CAQdyB,OARc,gBAQLC,UARK,gCASyB1B,QAAQ,CAAC,EAAD,CATjC,2CASd2B,eATc,gBASGC,kBATH,gCAUe5B,QAAQ,CAAC,EAAD,CAVvB,2CAUd6B,UAVc,gBAUFC,aAVE,gCAWqB9B,QAAQ,CAAC,CAAD,CAX7B,2CAWd+B,aAXc,gBAWCC,gBAXD,gBAYrB;AACA/B,SAAS,CAAC,UAAM,CACduB,UAAU,CAAC,IAAD,CAAV,CACAlB,KAAK,CACF2B,GADH,CACO,gBAAkBrB,MAAM,CAACsB,EADhC,EAEGC,IAFH,CAEQ,cAAc,IAAXC,CAAAA,IAAW,MAAXA,IAAW,CAClBlB,WAAW,CAACkB,IAAI,CAACnB,QAAL,CAAcoB,OAAd,EAAD,CAAX,CACAjB,kBAAkB,CAACgB,IAAI,CAACjB,eAAN,CAAlB,CACAK,UAAU,CAAC,KAAD,CAAV,CACD,CANH,EAOGc,KAPH,CAOS,SAACC,GAAD,CAAS,CACdnC,KAAK,CAACoC,KAAN,CAAY,yBAAZ,EACD,CATH,EAUD,CAZQ,CAYN,CAACT,aAAD,CAAgBnB,MAAM,CAACsB,EAAvB,CAZM,CAAT,CAcA;AACA,GAAMO,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACC,CAAD,CAAO,CAC3BA,CAAC,CAACC,cAAF,GACA,GAAI,CAACtC,eAAe,EAApB,CAAwB,CACtB,MAAOD,CAAAA,KAAK,CAACoC,KAAN,gBAA4B,CACjCI,QAAQ,CAAE,eADuB,CAEjCC,SAAS,CAAE,IAFsB,CAGjCC,eAAe,CAAE,KAHgB,CAIjCC,YAAY,CAAE,IAJmB,CAKjCC,YAAY,CAAE,IALmB,CAMjCC,SAAS,CAAE,IANsB,CAOjCC,QAAQ,CAAEC,SAPuB,CAA5B,CAAP,CASD,CAZ0B,gBAcXC,IAAI,CAACC,KAAL,CAAWC,YAAY,CAACC,IAAxB,CAdW,CAcnBC,GAdmB,aAcnBA,GAdmB,CAe3B,GAAIC,CAAAA,OAAO,CACTf,CAAC,CAACgB,MAAF,CAASC,IAAT,GAAkB,iBAAlB,EAAuClC,OAAO,GAAKiB,CAAC,CAACgB,MAAF,CAASxB,EAA5D,CACInB,eADJ,CAEIF,UAHN,CAIA,GAAI+C,CAAAA,GAAG,CAAG,EAAV,CACA,GAAIlB,CAAC,CAACgB,MAAF,CAASC,IAAT,GAAkB,iBAAlB,EAAuChC,eAAe,GAAK,EAA/D,CAAmE,CACjEiC,GAAG,CAAG,CACJL,IAAI,CAAEC,GADF,CAEJK,OAAO,CAAEJ,OAFL,CAGJ7C,MAAM,CAAEA,MAAM,CAACsB,EAHX,CAIJL,UAAU,CAAEA,UAJR,CAKJiC,aAAa,CAAEnC,eALX,CAAN,CAOD,CARD,IAQO,CACLiC,GAAG,CAAG,CACJL,IAAI,CAAEC,GADF,CAEJK,OAAO,CAAEJ,OAFL,CAGJ7C,MAAM,CAAEA,MAAM,CAACsB,EAHX,CAAN,CAKD,CAED,GAAIyB,CAAAA,IAAI,CAAGjB,CAAC,CAACgB,MAAF,CAASC,IAApB,CACA,GAAIF,OAAO,GAAK,EAAhB,CAAoB,CAClB,MAAOrD,CAAAA,KAAK,CAACoC,KAAN,CAAY,eAAZ,CAAP,CACD,CACDhB,UAAU,CAAC,IAAD,CAAV,CACA;AACAlB,KAAK,CACFyD,IADH,CACQ,gBAAkBnD,MAAM,CAACsB,EADjC,CACqC0B,GADrC,EAEGzB,IAFH,CAEQ,SAAC6B,GAAD,CAAS,CACb,GAAIA,GAAG,CAAC5B,IAAJ,CAAS6B,OAAb,CAAsB,CACpBC,OAAO,CAACC,GAAR,CAAYH,GAAG,CAAC5B,IAAhB,EACAd,YAAY,CAAC,KAAD,CAAZ,CACAE,UAAU,CAAC,KAAD,CAAV,CACA,GAAImC,IAAI,GAAK,YAAb,CAA2B,CACzB7C,aAAa,CAAC,EAAD,CAAb,CACD,CAFD,IAEO,CACLE,kBAAkB,CAAC,EAAD,CAAlB,CACD,CACDgB,gBAAgB,CAACD,aAAa,CAAG,CAAjB,CAAhB,CACD,CACF,CAdH,EAeGO,KAfH,CAeS,SAACE,KAAD,CAAW,CAChBpC,KAAK,CAACoC,KAAN,CAAY,qCAAZ,EACD,CAjBH,EAkBD,CA5DD,CA8DA;AACA,GAAM4B,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAAC1B,CAAD,CAAO,CAC1B,GAAIA,CAAC,CAACgB,MAAF,CAASC,IAAT,GAAkB,YAAtB,CAAoC,CAClC7C,aAAa,CAAC4B,CAAC,CAACgB,MAAF,CAASW,KAAV,CAAb,CACD,CAFD,IAEO,CACLrD,kBAAkB,CAAC0B,CAAC,CAACgB,MAAF,CAASW,KAAV,CAAlB,CACD,CACD;AACD,CAPD,CASA;AACA,GAAMC,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAAC7C,OAAD,CAAUE,eAAV,CAA2BE,UAA3B,CAA0C,CAC/DP,YAAY,CAAC,CAACD,SAAF,CAAZ,CACAK,UAAU,CAACD,OAAD,CAAV,CACAG,kBAAkB,CAACD,eAAD,CAAlB,CACAG,aAAa,CAACD,UAAD,CAAb,CACD,CALD,CAOA,mBACE,oBAAC,KAAD,CAAO,QAAP,MACGN,OAAO,CAAGf,WAAW,EAAd,CAAmB,IAD7B,cAEE,oBAAC,YAAD,EACE,QAAQ,CAAEiC,aADZ,CAEE,QAAQ,CAAE2B,YAFZ,CAGE,KAAK,CAAEvD,UAHT,CAIE,IAAI,CAAC,YAJP,EAFF,cAQE,oBAAC,aAAD,EACE,QAAQ,CAAEI,QADZ,CAEE,SAAS,CAAER,SAFb,CAGE,cAAc,CAAE6D,cAHlB,CAIE,SAAS,CAAEjD,SAJb,CAKE,QAAQ,CAAEoB,aALZ,CAME,QAAQ,CAAE2B,YANZ,CAOE,OAAO,CAAE3C,OAPX,CAQE,eAAe,CAAEV,eARnB,CASE,eAAe,CAAEI,eATnB,EARF,CADF,CAsBD,CAlID,CAoIA,cAAeR,CAAAA,QAAf","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport SingleComment from \"./singleComment\";\nimport CommentInput from \"./commentInput\";\nimport { toast } from \"react-toastify\";\nimport { isAuthenticated } from \"../../helper/auth\";\nimport axios from \"axios\";\nimport { useParams } from \"react-router-dom\";\nimport { showLoading } from \"../../helper/loading\";\nconst imageProf = require(\"../../../public/uploads/chef2.jpg\");\nconst Comments = () => {\n  const recipe = useParams();\n  const [newComment, setnewComment] = useState(\"\");\n  const [newReplyComment, setnewReplyComment] = useState(\"\");\n  const [comments, setComments] = useState([]);\n  const [repliedComments, setRepliedComments] = useState([]);\n  const [openReply, setOpenReply] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [replyId, setReplyId] = useState(\"\");\n  const [parentCommentId, setParentCommentId] = useState(\"\");\n  const [responseTo, setResponseTo] = useState(\"\");\n  const [commentsAdded, setCommentsAdded] = useState(0);\n  ///////////////////////////////////////////\n  useEffect(() => {\n    setLoading(true);\n    axios\n      .get(\"/api/comment/\" + recipe.id)\n      .then(({ data }) => {\n        setComments(data.comments.reverse());\n        setRepliedComments(data.repliedComments);\n        setLoading(false);\n      })\n      .catch((err) => {\n        toast.error(\"Unable to load comments\");\n      });\n  }, [commentsAdded, recipe.id]);\n\n  /////////////////////////////////////////\n  const handleComment = (e) => {\n    e.preventDefault();\n    if (!isAuthenticated()) {\n      return toast.error(`Please login`, {\n        position: \"bottom-center\",\n        autoClose: 5000,\n        hideProgressBar: false,\n        closeOnClick: true,\n        pauseOnHover: true,\n        draggable: true,\n        progress: undefined,\n      });\n    }\n\n    const { _id } = JSON.parse(localStorage.user);\n    let comment =\n      e.target.name === \"newReplyComment\" || replyId === e.target.id\n        ? newReplyComment\n        : newComment;\n    let obj = {};\n    if (e.target.name === \"newReplyComment\" && parentCommentId !== \"\") {\n      obj = {\n        user: _id,\n        content: comment,\n        recipe: recipe.id,\n        responseTo: responseTo,\n        parentComment: parentCommentId,\n      };\n    } else {\n      obj = {\n        user: _id,\n        content: comment,\n        recipe: recipe.id,\n      };\n    }\n\n    let name = e.target.name;\n    if (comment === \"\") {\n      return toast.error(\"empty comment\");\n    }\n    setLoading(true);\n    // this.setState({ loading: true });\n    axios\n      .post(\"/api/comment/\" + recipe.id, obj)\n      .then((res) => {\n        if (res.data.success) {\n          console.log(res.data);\n          setOpenReply(false);\n          setLoading(false);\n          if (name === \"newComment\") {\n            setnewComment(\"\");\n          } else {\n            setnewReplyComment(\"\");\n          }\n          setCommentsAdded(commentsAdded + 1);\n        }\n      })\n      .catch((error) => {\n        toast.error(\"Error occured while posting comment\");\n      });\n  };\n\n  ///////////////////////////////////////////\n  const handleChange = (e) => {\n    if (e.target.name === \"newComment\") {\n      setnewComment(e.target.value);\n    } else {\n      setnewReplyComment(e.target.value);\n    }\n    // this.setState({ [e.target.name]: e.target.value });\n  };\n\n  ///////////////////////////////////////////\n  const showReplyInput = (replyId, parentCommentId, responseTo) => {\n    setOpenReply(!openReply);\n    setReplyId(replyId);\n    setParentCommentId(parentCommentId);\n    setResponseTo(responseTo);\n  };\n\n  return (\n    <React.Fragment>\n      {loading ? showLoading() : null}\n      <CommentInput\n        onSubmit={handleComment}\n        onChange={handleChange}\n        value={newComment}\n        name=\"newComment\"\n      />\n      <SingleComment\n        comments={comments}\n        imageProf={imageProf}\n        showReplyInput={showReplyInput}\n        openReply={openReply}\n        onSubmit={handleComment}\n        onChange={handleChange}\n        replyId={replyId}\n        newReplyComment={newReplyComment}\n        repliedComments={repliedComments}\n      />\n    </React.Fragment>\n  );\n};\n\nexport default Comments;\n"]},"metadata":{},"sourceType":"module"}