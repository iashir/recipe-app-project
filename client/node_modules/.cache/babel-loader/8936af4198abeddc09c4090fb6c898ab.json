{"ast":null,"code":"import _regeneratorRuntime from\"/Users/iashir/Desktop/WorkProjects/Recipe/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/iashir/Desktop/WorkProjects/Recipe/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"/Users/iashir/Desktop/WorkProjects/Recipe/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/Users/iashir/Desktop/WorkProjects/Recipe/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/iashir/Desktop/WorkProjects/Recipe/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/iashir/Desktop/WorkProjects/Recipe/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/iashir/Desktop/WorkProjects/Recipe/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import{Link}from\"react-router-dom\";import axios from\"axios\";import classnames from\"classnames\";import Validator from\"validator\";import M from\"materialize-css\";import\"materialize-css/dist/css/materialize.min.css\";import{toast}from\"react-toastify\";import{showLoading}from\"../helper/loading\";var AddRecipe=/*#__PURE__*/function(_Component){_inherits(AddRecipe,_Component);var _super=_createSuper(AddRecipe);function AddRecipe(){var _this;_classCallCheck(this,AddRecipe);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={_id:\"\",title:\"\",body:\"\",status:\"\",recipeImageName:\"\",recipeImageLocation:\"\",recipeImage:null,oldRecipeImage:true,user:{},errors:{},loading:false};_this.componentDidMount=function(){var _JSON$parse=JSON.parse(localStorage.user),_id=_JSON$parse._id;_this.setState({user:_id});var params=_this.props.match.params.id;axios.get(\"/api/recipes/\"+params).then(function(_ref){var data=_ref.data;var title=data.title,body=data.body,status=data.status,recipeImageName=data.recipeImageName,recipeImageLocation=data.recipeImageLocation,_id=data._id;_this.setState({title:title,body:body,status:status,recipeImageName:recipeImageName,recipeImageLocation:recipeImageLocation,_id:_id});});var select=document.querySelectorAll(\"select\");M.FormSelect.init(select);};_this.handleChange=function(event){if(event.target.id===\"recipeImage\"){_this.setState({recipeImage:event.target.files[0],oldRecipeImage:false});}else{_this.setState(_defineProperty({},event.target.id,event.target.value));_this.validateForm(event.target.id,event.target.value);}};_this.handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var _this$state,title,body,status,user,recipeImage,_id,oldRecipeImage,formData,obj;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();_this.setState({loading:true});_this$state=_this.state,title=_this$state.title,body=_this$state.body,status=_this$state.status,user=_this$state.user,recipeImage=_this$state.recipeImage,_id=_this$state._id,oldRecipeImage=_this$state.oldRecipeImage;if(oldRecipeImage){_context.next=16;break;}console.log(\"WITH IMAGE\");formData=new FormData();formData.append(\"recipeImage\",recipeImage,recipeImage.name);formData.append(\"title\",title);formData.append(\"status\",status);formData.append(\"user\",user);formData.append(\"body\",body);console.log(formData);_context.next=14;return axios.put(\"/api/recipes/\"+_id,formData,{headers:{accept:\"application/json\",\"Accept-Language\":\"en-US,en;q=0.8\",\"Content-Type\":\"multipart/form-data; boundary=\".concat(formData._boundary)}}).then(function(data){toast.success(\"success\",{position:\"bottom-center\",autoClose:5000,hideProgressBar:false,closeOnClick:true,pauseOnHover:true,draggable:true,progress:undefined});_this.props.history.push(\"/recipes\");}).catch(function(error){if(\"LIMIT_FILE_SIZE\"===error.code){_this.setState({errors:\"Max size 5MB\"});}else{_this.setState({errors:error.response.data});}});case 14:_context.next=20;break;case 16:console.log(\"NO IMAGE\");obj={title:title,body:body,status:status,user:user,_id:_id};_context.next=20;return axios.put(\"/api/recipes/\"+_id,obj).then(function(data){toast.success(\"success\",{position:\"bottom-center\",autoClose:5000,hideProgressBar:false,closeOnClick:true,pauseOnHover:true,draggable:true,progress:undefined});_this.props.history.push(\"/recipes/\"+_id);}).catch(function(err){return _this.setState({errors:err.response.data});});case 20:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}();return _this;}_createClass(AddRecipe,[{key:\"validateForm\",value:function validateForm(fieldName,value){var errors=this.state.errors;switch(fieldName){case\"title\":if(Validator.isEmpty(value)){errors.title=\"Title field is required\";break;}errors.title=\"\";break;case\"body\":if(Validator.isEmpty(value)){errors.body=\"Description field is required\";break;}errors.body=\"\";break;default:break;}}},{key:\"render\",value:function render(){var _this$state2=this.state,title=_this$state2.title,body=_this$state2.body,errors=_this$state2.errors,status=_this$state2.status,loading=_this$state2.loading,recipeImageName=_this$state2.recipeImageName;return/*#__PURE__*/React.createElement(React.Fragment,null,loading?showLoading():null,/*#__PURE__*/React.createElement(\"div\",{className:\"container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"card\"},/*#__PURE__*/React.createElement(\"div\",{className:\"card-content\"},/*#__PURE__*/React.createElement(\"h3\",null,\"Add Recipe\"),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"form\",{onSubmit:this.handleSubmit,noValidate:true,encType:\"multipart/form-data\"},/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"file-field input-field\"},/*#__PURE__*/React.createElement(\"div\",{className:\"btn\"},/*#__PURE__*/React.createElement(\"span\",null,\"Select\"),/*#__PURE__*/React.createElement(\"input\",{name:\"recipeImage\",onChange:this.handleChange,type:\"file\",id:\"recipeImage\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"file-path-wrapper\"},/*#__PURE__*/React.createElement(\"input\",{type:\"text\",placeholder:\"Recipe image(must be less than 5MB)\",defaultValue:recipeImageName,className:classnames(\"file-path \",{invalid:errors.recipeImage})}),/*#__PURE__*/React.createElement(\"span\",{className:\"red-text\"},errors.recipeImage)))),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"input-field\"},/*#__PURE__*/React.createElement(\"input\",{value:title,onChange:this.handleChange,type:\"text\",id:\"title\",className:classnames(\"\",{invalid:errors.title})}),/*#__PURE__*/React.createElement(\"label\",{className:\"active\",htmlFor:\"title\"},\"Title\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"input-field\"},/*#__PURE__*/React.createElement(\"textarea\",{value:body,onChange:this.handleChange,id:\"body\",className:classnames(\"materialize-textarea\",{invalid:errors.body})}),/*#__PURE__*/React.createElement(\"label\",{className:\"active\",htmlFor:\"body\"},\"Description\"),/*#__PURE__*/React.createElement(\"span\",{className:\"red-text\"},errors.body))),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"input-field\"},/*#__PURE__*/React.createElement(\"select\",{id:\"status\",onChange:this.handleChange,className:classnames(\"\",{invalid:errors.status}),value:status},/*#__PURE__*/React.createElement(\"option\",{value:\"public\"},\"Public\"),/*#__PURE__*/React.createElement(\"option\",{value:\"private\"},\"Private\")),/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"status\"},\"Choose status of your recipe\"),/*#__PURE__*/React.createElement(\"span\",{className:\"red-text\"},errors.status))),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"input\",{type:\"submit\",value:\"Save\",className:\"btn\"}),/*#__PURE__*/React.createElement(Link,{to:\"/recipes\",className:\"btn orange\"},\"Cancel\"))))))));}}]);return AddRecipe;}(Component);export default AddRecipe;","map":{"version":3,"sources":["/Users/iashir/Desktop/WorkProjects/Recipe/client/src/components/admin/editRecipe.jsx"],"names":["React","Component","Link","axios","classnames","Validator","M","toast","showLoading","AddRecipe","state","_id","title","body","status","recipeImageName","recipeImageLocation","recipeImage","oldRecipeImage","user","errors","loading","componentDidMount","JSON","parse","localStorage","setState","params","props","match","id","get","then","data","select","document","querySelectorAll","FormSelect","init","handleChange","event","target","files","value","validateForm","handleSubmit","preventDefault","console","log","formData","FormData","append","name","put","headers","accept","_boundary","success","position","autoClose","hideProgressBar","closeOnClick","pauseOnHover","draggable","progress","undefined","history","push","catch","error","code","response","obj","err","fieldName","isEmpty","invalid"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport axios from \"axios\";\nimport classnames from \"classnames\";\nimport Validator from \"validator\";\nimport M from \"materialize-css\";\nimport \"materialize-css/dist/css/materialize.min.css\";\nimport { toast } from \"react-toastify\";\nimport { showLoading } from \"../helper/loading\";\nclass AddRecipe extends Component {\n  state = {\n    _id: \"\",\n    title: \"\",\n    body: \"\",\n    status: \"\",\n    recipeImageName: \"\",\n    recipeImageLocation: \"\",\n    recipeImage: null,\n    oldRecipeImage: true,\n    user: {},\n    errors: {},\n    loading: false,\n  };\n  componentDidMount = () => {\n    const { _id } = JSON.parse(localStorage.user);\n    this.setState({ user: _id });\n    const params = this.props.match.params.id;\n    axios.get(\"/api/recipes/\" + params).then(({ data }) => {\n      const {\n        title,\n        body,\n        status,\n        recipeImageName,\n        recipeImageLocation,\n        _id,\n      } = data;\n      this.setState({\n        title,\n        body,\n        status,\n        recipeImageName,\n        recipeImageLocation,\n        _id,\n      });\n    });\n    var select = document.querySelectorAll(\"select\");\n    M.FormSelect.init(select);\n  };\n\n  handleChange = (event) => {\n    if (event.target.id === \"recipeImage\") {\n      this.setState({\n        recipeImage: event.target.files[0],\n        oldRecipeImage: false,\n      });\n    } else {\n      this.setState({ [event.target.id]: event.target.value });\n      this.validateForm(event.target.id, event.target.value);\n    }\n  };\n  handleSubmit = async (event) => {\n    event.preventDefault();\n    this.setState({ loading: true });\n    const {\n      title,\n      body,\n      status,\n      user,\n      recipeImage,\n      _id,\n      oldRecipeImage,\n    } = this.state;\n    if (!oldRecipeImage) {\n      console.log(\"WITH IMAGE\");\n      let formData = new FormData();\n      formData.append(\"recipeImage\", recipeImage, recipeImage.name);\n      formData.append(\"title\", title);\n      formData.append(\"status\", status);\n      formData.append(\"user\", user);\n      formData.append(\"body\", body);\n      console.log(formData);\n\n      await axios\n        .put(\"/api/recipes/\" + _id, formData, {\n          headers: {\n            accept: \"application/json\",\n            \"Accept-Language\": \"en-US,en;q=0.8\",\n            \"Content-Type\": `multipart/form-data; boundary=${formData._boundary}`,\n          },\n        })\n        .then((data) => {\n          toast.success(`success`, {\n            position: \"bottom-center\",\n            autoClose: 5000,\n            hideProgressBar: false,\n            closeOnClick: true,\n            pauseOnHover: true,\n            draggable: true,\n            progress: undefined,\n          });\n          this.props.history.push(\"/recipes\");\n        })\n        .catch((error) => {\n          if (\"LIMIT_FILE_SIZE\" === error.code) {\n            this.setState({ errors: \"Max size 5MB\" });\n          } else {\n            this.setState({ errors: error.response.data });\n          }\n        });\n    } else {\n      console.log(\"NO IMAGE\");\n\n      const obj = {\n        title,\n        body,\n        status,\n        user,\n        _id,\n      };\n      await axios\n        .put(\"/api/recipes/\" + _id, obj)\n        .then((data) => {\n          toast.success(`success`, {\n            position: \"bottom-center\",\n            autoClose: 5000,\n            hideProgressBar: false,\n            closeOnClick: true,\n            pauseOnHover: true,\n            draggable: true,\n            progress: undefined,\n          });\n          this.props.history.push(\"/recipes/\" + _id);\n        })\n        .catch((err) => this.setState({ errors: err.response.data }));\n    }\n  };\n  validateForm(fieldName, value) {\n    const { errors } = this.state;\n    switch (fieldName) {\n      case \"title\":\n        if (Validator.isEmpty(value)) {\n          errors.title = \"Title field is required\";\n          break;\n        }\n        errors.title = \"\";\n        break;\n      case \"body\":\n        if (Validator.isEmpty(value)) {\n          errors.body = \"Description field is required\";\n          break;\n        }\n        errors.body = \"\";\n        break;\n      default:\n        break;\n    }\n  }\n  render() {\n    const {\n      title,\n      body,\n      errors,\n      status,\n      loading,\n      recipeImageName,\n    } = this.state;\n    return (\n      <React.Fragment>\n        {loading ? showLoading() : null}\n        <div className=\"container\">\n          <div className=\"card\">\n            <div className=\"card-content\">\n              <h3>Add Recipe</h3>\n              <div className=\"row\">\n                <form\n                  onSubmit={this.handleSubmit}\n                  noValidate\n                  encType=\"multipart/form-data\"\n                >\n                  <div className=\"row\">\n                    <div className=\"file-field input-field\">\n                      <div className=\"btn\">\n                        <span>Select</span>\n                        <input\n                          name=\"recipeImage\"\n                          onChange={this.handleChange}\n                          type=\"file\"\n                          id=\"recipeImage\"\n                        />\n                      </div>\n                      <div className=\"file-path-wrapper\">\n                        <input\n                          type=\"text\"\n                          placeholder=\"Recipe image(must be less than 5MB)\"\n                          defaultValue={recipeImageName}\n                          className={classnames(\"file-path \", {\n                            invalid: errors.recipeImage,\n                          })}\n                        />\n                        <span className=\"red-text\">{errors.recipeImage}</span>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"row\">\n                    <div className=\"input-field\">\n                      <input\n                        value={title}\n                        onChange={this.handleChange}\n                        type=\"text\"\n                        id=\"title\"\n                        className={classnames(\"\", {\n                          invalid: errors.title,\n                        })}\n                      />\n                      <label className=\"active\" htmlFor=\"title\">\n                        Title\n                      </label>\n                    </div>\n                  </div>\n\n                  <div className=\"row\">\n                    <div className=\"input-field\">\n                      <textarea\n                        value={body}\n                        onChange={this.handleChange}\n                        id=\"body\"\n                        className={classnames(\"materialize-textarea\", {\n                          invalid: errors.body,\n                        })}\n                      ></textarea>\n                      <label className=\"active\" htmlFor=\"body\">\n                        Description\n                      </label>\n                      <span className=\"red-text\">{errors.body}</span>\n                    </div>\n                  </div>\n\n                  <div className=\"row\">\n                    <div className=\"input-field\">\n                      <select\n                        id=\"status\"\n                        onChange={this.handleChange}\n                        className={classnames(\"\", {\n                          invalid: errors.status,\n                        })}\n                        value={status}\n                      >\n                        <option value=\"public\">Public</option>\n                        <option value=\"private\">Private</option>\n                      </select>\n                      <label htmlFor=\"status\">\n                        Choose status of your recipe\n                      </label>\n                      <span className=\"red-text\">{errors.status}</span>\n                    </div>\n                  </div>\n\n                  <div className=\"row\">\n                    <input type=\"submit\" value=\"Save\" className=\"btn\" />\n                    <Link to=\"/recipes\" className=\"btn orange\">\n                      Cancel\n                    </Link>\n                  </div>\n                </form>\n              </div>\n            </div>\n          </div>\n        </div>\n      </React.Fragment>\n    );\n  }\n}\n\nexport default AddRecipe;\n"]},"metadata":{},"sourceType":"module"}